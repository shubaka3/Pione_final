<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Trang trại Thông minh</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts (Roboto) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* == CẬP NHẬT: LIGHT MODE (CHẾ ĐỘ SÁNG) == */
        :root {
            /* Màu sắc tươi sáng (vẫn giữ nguyên) */
            --primary-color: #60a5fa; /* Blue 400 */
            --primary-accent: #4ade80; /* Green 400 */
            --danger-color: #f87171; /* Red 400 */
            --success-color: #4ade80; /* Green 400 */

            /* CẬP NHẬT: Màu nền và văn bản cho Light Mode */
            --bg-color: #f9fafb;     /* Gray 50 (Nền sáng) */
            --card-color: #ffffff;   /* White (Nền thẻ) */
            --border-color: #e5e7eb; /* Gray 200 (Viền) */
            --text-primary: #111827; /* Gray 900 (Chữ chính) */
            --text-secondary: #374151; /* Gray 700 (Chữ phụ) */
            --text-muted: #6b7280;   /* Gray 500 (Chữ mờ) */
        }
        body { 
            background-color: var(--bg-color); 
            color: var(--text-primary); 
            font-family: 'Roboto', sans-serif; 
        }
        .card { 
            background-color: var(--card-color); 
            border: 1px solid var(--border-color); 
            border-radius: 0.75rem; 
            /* CẬP NHẬT: Shadow cho Light Mode */
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05);
        }
        
        /* Styles cho button (từ vibe của bạn) */
        .btn { padding: 10px 20px; font-weight: 500; border-radius: 0.5rem; transition: all 0.2s ease; border: 1px solid transparent; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; }
        .btn:disabled { cursor: not-allowed; opacity: 0.5; }
        /* CẬP NHẬT: Màu chữ button trên nền sáng */
        .btn-primary { background-color: var(--primary-color); color: var(--text-primary); }
        .btn-primary:hover:not(:disabled) { filter: brightness(1.05); }


        .chart-container {
            position: relative;
            height: 300px; 
            width: 100%;
        }
    </style>
</head>
<body class="p-4 sm:p-6">

    <div class="container mx-auto">
        <!-- Tiêu đề (CẬP NHẬT: text-blue-500 đậm hơn) -->
        <h1 class="text-3xl font-bold text-blue-500 mb-6">Dashboard Trang trại Thông minh</h1>

        <!-- == KHU VỰC QUẢN LÝ CÂY TRỒNG == -->
        <h2 class="text-2xl font-semibold text-blue-500 mb-4">Quản lý Cây Trồng (Tất cả: Cà chua bi)</h2>
        
        <div class="card p-0 overflow-hidden"> 
            <div class="overflow-x-auto">
                <!-- CẬP NHẬT: Màu bảng cho Light Mode -->
                <table class="w-full text-left min-w-[800px]">
                    <thead class="bg-gray-100 text-xs text-gray-500 uppercase font-semibold">
                        <tr>
                            <th class="p-3 px-4">Tên Cây</th>
                            <th class="p-3 px-4">Loài</th>
                            <th class="p-3 px-4">Vị trí</th>
                            <th class="p-3 px-4">Độ ẩm (Sensor)</th>
                            <th class="p-3 px-4">Số quả (AI)</th>
                            <th class="p-3 px-4">Chất lượng (AI)</th>
                            <th class="p-3 px-4">Tình trạng Bệnh (AI)</th>
                        </tr>
                    </thead>
                    <tbody class="text-sm divide-y divide-gray-200">
                        <!-- Cập nhật màu chữ cho Light Mode -->
                        <tr>
                            <td class="p-3 px-4 font-medium text-gray-900">Cây Mẫu 1</td>
                            <td class="p-3 px-4 text-gray-700">Cà chua bi</td>
                            <td class="p-3 px-4 text-gray-700">N/A (Phòng kín)</td>
                            <td class="p-3 px-4 text-blue-500 font-medium">68%</td>
                            <td class="p-3 px-4 text-gray-900 font-medium">12</td>
                            <td class="p-3 px-4 text-gray-700">Tốt</td>
                            <td class="p-3 px-4 text-green-500 font-medium">Khỏe</td>
                        </tr>
                        <tr>
                            <td class="p-3 px-4 font-medium text-gray-900">Cây mẫu 2</td>
                            <td class="p-3 px-4 text-gray-700">Cà chua bi</td>
                            <td class="p-3 px-4 text-gray-700">Không rõ</td>
                            <td class="p-3 px-4 text-blue-500 font-medium">75%</td>
                            <td class="p-3 px-4 text-gray-900 font-medium">8</td>
                            <td class="p-3 px-4 text-yellow-500">Trung bình</td>
                            <td class="p-3 px-4 text-red-500 font-medium">Phát hiện đốm lá</td>
                        </tr>
                        <tr>
                            <td class="p-3 px-4 font-medium text-gray-900">Plant_A1</td>
                            <td class="p-3 px-4 text-gray-700">Cà chua bi</td>
                            <td class="p-3 px-4 text-gray-700">A1-E2</td>
                            <td class="p-3 px-4 text-blue-500 font-medium">71%</td>
                            <td class="p-3 px-4 text-gray-900 font-medium">14</td>
                            <td class="p-3 px-4 text-gray-700">Tốt</td>
                            <td class="p-3 px-4 text-green-500 font-medium">Khỏe</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- CẬP NHẬT: Đường phân cách Light Mode -->
        <hr class="border-gray-200 my-6">

        <!-- == KHU VỰC BIỂU ĐỒ CHUNG == -->
        <h2 class="text-2xl font-semibold text-blue-500 mb-4">Dashboard Chung</h2>
        <div class="grid grid-cols-1 gap-6">

            <!-- 0. (MỚI) Biểu đồ Sinh trưởng (Tất cả cây) -->
            <div class="card p-4">
                <h2 class="text-xl font-semibold text-blue-500 mb-3">Theo dõi Sinh trưởng (Tất cả cây - 4 tuần)</h2>
                <div class="chart-container">
                    <canvas id="allPlantsGrowthChart"></canvas>
                </div>
            </div>

            <!-- 1. Biểu đồ Môi trường (Không khí) -->
            <div class="card p-4">
                <h2 class="text-xl font-semibold text-blue-500 mb-3">Thông số Môi trường (24 giờ qua)</h2>
                <div class="chart-container">
                    <canvas id="envChart"></canvas>
                </div>
            </div>

            <!-- 2. Biểu đồ Độ ẩm đất -->
            <div class="card p-4">
                <h2 class="text-xl font-semibold text-blue-500 mb-3">Độ ẩm Đất (Hiện tại)</h2>
                <div class="chart-container">
                    <canvas id="soilMoistureChart"></canvas>
                </div>
            </div>

            <!-- 7. (MỚI) Bảng Dự đoán Thời điểm Trồng -->
            <div class="card p-4">
                <h2 class="text-xl font-semibold text-blue-500 mb-3">Dự đoán Thời điểm Trồng</h2>
                <div class="overflow-x-auto pt-2">
                    <!-- CẬP NHẬT: Màu bảng cho Light Mode -->
                    <table class="w-full text-sm">
                        <thead class="bg-gray-100 text-gray-500">
                            <tr>
                                <th class="p-2 text-left font-medium">Vụ</th>
                                <th class="p-2 text-left font-medium">Thời điểm Tốt nhất</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200 text-gray-700">
                            <tr>
                                <td class="p-2 font-medium text-gray-900">Vụ Xuân Hè</td>
                                <td class="p-2">Tháng 2 - Tháng 3</td>
                            </tr>
                            <tr>
                                <td class="p-2 font-medium text-gray-900">Vụ Thu Đông</td>
                                <td class="p-2">Tháng 8 - Tháng 9</td>
                            </tr>
                            <tr>
                                <td class="p-2 font-medium text-gray-900">Trái vụ (Nhà kính)</td>
                                <td class="p-2">Quanh năm (cần Đèn)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 3. Biểu đồ Chất lượng đất (pH, EC) -->
            <div class="card p-4">
                <h2 class="text-xl font-semibold text-blue-500 mb-3">Chất lượng Đất</h2>
                <div class="chart-container">
                    <canvas id="soilQualityChart"></canvas>
                </div>
            </div>

            <!-- 8. (MỚI) Bảng Dự đoán Sản lượng -->
            <div class="card p-4">
                <h2 class="text-xl font-semibold text-blue-500 mb-3">Dự đoán Sản lượng (Tháng)</h2>
                <div class="overflow-x-auto pt-2">
                    <!-- CẬP NHẬT: Màu bảng cho Light Mode -->
                    <table class="w-full text-sm">
                        <thead class="bg-gray-100 text-gray-500">
                            <tr>
                                <th class="p-2 text-left font-medium">Tháng</th>
                                <th class="p-2 text-left font-medium">Sản lượng (kg)</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200 text-gray-700">
                            <tr>
                                <td class="p-2 font-medium text-gray-900">Tháng 10 (Đã thu)</td>
                                <td class="p-2">115 kg</td>
                            </tr>
                            <tr>
                                <td class="p-2 font-medium text-blue-500">Tháng 11 (Hiện tại)</td>
                                <td class="p-2 text-blue-500">~130 kg</td>
                            </tr>
                            <tr>
                                <td class="p-2 font-medium text-gray-400">Tháng 12 (Dự đoán)</td>
                                <td class="p-2 text-gray-400">~145 kg</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- 4. Biểu đồ Chất lượng Nước -->
            <div class="card p-4">
                <h2 class="text-xl font-semibold text-blue-500 mb-3">Chất lượng Nước tưới</h2>
                <div class="chart-container">
                    <canvas id="waterQualityChart"></canvas>
                </div>
            </div>
            
            <!-- 5. Biểu đồ Sinh trưởng (Hàng tuần) -->
            <div class="card p-4">
                <h2 class="text-xl font-semibold text-blue-500 mb-3">Theo dõi Sinh trưởng (4 tuần)</h2>
                <div class="chart-container">
                    <canvas id="plantGrowthChart"></canvas>
                </div>
            </div>

            <!-- 6. Biểu đồ Dự báo Tài chính -->
            <div class="card p-4">
                <h2 class="text-xl font-semibold text-blue-500 mb-3">Báo cáo Tài chính (Dự báo Tháng này)</h2>
                <div class="chart-container" style="height: 350px;">
                    <canvas id="financeChart"></canvas>
                </div>
            </div>

        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // CẬP NHẬT: Cài đặt chung của Chart.js cho LIGHT MODE
            Chart.defaults.color = 'var(--text-secondary)'; // Chữ (Gray 700)
            Chart.defaults.borderColor = 'var(--border-color)'; // Đường kẻ (Gray 200)

            // --- Helper Functions (giữ nguyên) ---
            const generateHourlyLabels = (hours) => {
                const labels = [];
                for (let i = 0; i < hours; i++) {
                    labels.push(`${String(i).padStart(2, '0')}:00`);
                }
                return labels;
            };

            const generateRealisticData = (base, variation, length, min = -Infinity, max = Infinity) => {
                const data = [];
                let prev = base;
                for (let i = 0; i < length; i++) {
                    let value = prev + (Math.random() - 0.5) * variation;
                    if (value < min) value = min;
                    if (value > max) value = max;
                    data.push(value.toFixed(1));
                    prev = value;
                }
                return data;
            };

            // --- 0. (MỚI) Biểu đồ Sinh trưởng (Tất cả cây) ---
            // CẬP NHẬT: Màu nền (backgroundColor) cho Light Mode (độ mờ 0.2)
            const ctxAllPlants = document.getElementById('allPlantsGrowthChart').getContext('2d');
            new Chart(ctxAllPlants, {
                type: 'line',
                data: {
                    labels: ['Tuần 1', 'Tuần 2', 'Tuần 3', 'Tuần 4'],
                    datasets: [
                        {
                            label: 'Cây Mẫu 1 (cm)',
                            data: [15, 27, 44, 60],
                            borderColor: 'var(--primary-color)',
                            backgroundColor: 'rgba(96, 165, 250, 0.2)', 
                            tension: 0.1,
                            fill: true 
                        },
                        {
                            label: 'Cây mẫu 2 (cm)',
                            data: [14, 25, 42, 58],
                            borderColor: 'var(--danger-color)',
                            backgroundColor: 'rgba(248, 113, 113, 0.2)', 
                            tension: 0.1,
                            fill: true 
                        },
                        {
                            label: 'Plant_A1 (cm)',
                            data: [16, 28, 45, 62],
                            borderColor: 'var(--primary-accent)',
                            backgroundColor: 'rgba(74, 222, 128, 0.2)', 
                            tension: 0.1,
                            fill: true 
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Chiều cao (cm)' }
                        }
                    }
                }
            });


            // --- 1. Biểu đồ Môi trường (Không khí) ---
            // CẬP NHẬT: Màu nền (backgroundColor) cho Light Mode (độ mờ 0.2)
            const ctxEnv = document.getElementById('envChart').getContext('2d');
            new Chart(ctxEnv, {
                type: 'line',
                data: {
                    labels: generateHourlyLabels(24),
                    datasets: [
                        {
                            label: 'Nhiệt độ không khí (°C)',
                            data: generateRealisticData(28, 1.5, 24, 22, 35),
                            borderColor: 'var(--danger-color)',
                            backgroundColor: 'rgba(248, 113, 113, 0.2)', 
                            tension: 0.3,
                            yAxisID: 'yTemp',
                            fill: true 
                        },
                        {
                            label: 'Độ ẩm không khí (%RH)',
                            data: generateRealisticData(75, 5, 24, 60, 95),
                            borderColor: 'var(--primary-color)',
                            backgroundColor: 'rgba(96, 165, 250, 0.2)',
                            tension: 0.3,
                            yAxisID: 'yHumidity',
                            fill: true 
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        yTemp: {
                            type: 'linear',
                            position: 'left',
                            title: { display: true, text: '°C' },
                            grid: { drawOnChartArea: false } 
                        },
                        yHumidity: {
                            type: 'linear',
                            position: 'right',
                            title: { display: true, text: '%RH' },
                            min: 0,
                            max: 100
                        }
                    }
                }
            });

            // --- 2. Biểu đồ Độ ẩm đất (Gauge) ---
            const ctxSoilMoisture = document.getElementById('soilMoistureChart').getContext('2d');
            const soilMoistureValue = 72; // 72%
            new Chart(ctxSoilMoisture, {
                type: 'doughnut',
                data: {
                    labels: ['Độ ẩm', 'Thiếu hụt'],
                    datasets: [{
                        data: [soilMoistureValue, 100 - soilMoistureValue],
                        // CẬP NHẬT: Màu nền thiếu hụt là --border-color (Gray 200)
                        backgroundColor: ['var(--primary-color)', 'var(--border-color)'],
                        borderColor: 'var(--card-color)', // Viền trắng (nền thẻ)
                        borderWidth: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    circumference: 180,
                    rotation: 270,
                    cutout: '70%',
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false },
                        title: {
                            display: true,
                            text: `${soilMoistureValue}%`,
                            position: 'bottom',
                            font: { size: 36, weight: 'bold' },
                            // CẬP NHẬT: Màu chữ chính (Gray 900)
                            color: 'var(--text-primary)', 
                            padding: { top: -20 }
                        }
                    }
                }
            });

            // --- 3. Biểu đồ Chất lượng đất (pH, EC) ---
            const ctxSoilQuality = document.getElementById('soilQualityChart').getContext('2d');
            new Chart(ctxSoilQuality, {
                type: 'bar',
                data: {
                    labels: ['pH Đất', 'EC Đất (µS/cm)'],
                    datasets: [
                        {
                            label: 'Hiện tại',
                            data: [6.8, 1150], // Giá trị ảo
                            /* CẬP NHẬT: Đổi màu sang Xanh lá và Vàng đậm */
                            backgroundColor: [
                                '#22c55e', // Green 500
                                '#facc15'  // Yellow 400
                            ],
                        },
                        {
                            label: 'Lý tưởng (Tối thiểu)',
                            data: [6.0, 800], // Mức lý tưởng
                            backgroundColor: '#fed7aa', // Cam nhạt
                        },
                        {
                            label: 'Lý tưởng (Tối đa)',
                            data: [7.0, 1500], // Mức lý tưởng
                            backgroundColor: '#fed7aa', // Cam nhạt
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });

            // --- 4. Biểu đồ Chất lượng Nước ---
            const ctxWaterQuality = document.getElementById('waterQualityChart').getContext('2d');
            new Chart(ctxWaterQuality, {
                type: 'bar',
                data: {
                    labels: ['pH Nước', 'TDS Nước (ppm)'],
                    datasets: [{
                        label: 'Giá trị đo',
                        data: [7.1, 480], // Giá trị ảo
                        /* CẬP NHẬT: Đổi màu sang Xanh dương và Cam */
                        backgroundColor: [
                            '#3b82f6', // Blue 500
                            '#f97316'  // Orange 500
                        ],
                    }]
                },
                options: {
                    indexAxis: 'y', // Biểu đồ ngang
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    }
                }
            });

            // --- 5. Biểu đồ Sinh trưởng (Hàng tuần) ---
            // CẬP NHẬT: Màu nền (backgroundColor) cho Light Mode (độ mờ 0.2)
            const ctxPlantGrowth = document.getElementById('plantGrowthChart').getContext('2d');
            new Chart(ctxPlantGrowth, {
                type: 'line',
                data: {
                    labels: ['Tuần 1', 'Tuần 2', 'Tuần 3', 'Tuần 4'],
                    datasets: [
                        {
                            label: 'Chiều cao cây (cm)',
                            data: [15, 28, 45, 62],
                            borderColor: 'var(--primary-accent)',
                            backgroundColor: 'rgba(74, 222, 128, 0.2)',
                            tension: 0.1,
                            yAxisID: 'yHeight',
                            fill: true 
                        },
                        {
                            label: 'Chỉ số NDVI',
                            data: [0.65, 0.70, 0.78, 0.82],
                            borderColor: 'var(--primary-color)',
                            backgroundColor: 'rgba(96, 165, 250, 0.2)',
                            tension: 0.1,
                            yAxisID: 'yNDVI',
                            fill: true 
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        yHeight: {
                            type: 'linear',
                            position: 'left',
                            title: { display: true, text: 'cm' }
                        },
                        yNDVI: {
                            type: 'linear',
                            position: 'right',
                            min: 0,
                            max: 1,
                            title: { display: true, text: 'NDVI' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });

            // --- 6. Biểu đồ Dự báo Tài chính ---
            const ctxFinance = document.getElementById('financeChart').getContext('2d');
            const revenue = 120500000; // Doanh thu
            const cost = 35200000; // Chi phí
            const profit = revenue - cost;
            new Chart(ctxFinance, {
                type: 'bar',
                data: {
                    labels: ['Doanh thu', 'Chi phí', 'Lợi nhuận (trước thuế)'],
                    datasets: [{
                        label: 'Số tiền (VND)',
                        data: [revenue, cost, profit],
                        /* CẬP NHẬT: Đổi màu sang Xanh (Doanh thu), Đỏ (Chi phí), Vàng (Lợi nhuận) */
                        backgroundColor: [
                            '#22c55e', // Green 500
                            '#ef4444', // Red 500
                            '#facc15'  // Yellow 400
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                // Format số tiền sang VND
                                callback: (value) => new Intl.NumberFormat('vi-VN', {
                                    style: 'currency',
                                    currency: 'VND'
                                }).format(value)
                            }
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>